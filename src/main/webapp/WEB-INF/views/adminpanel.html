<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Bootstrap 4 Admin Panel">
    <meta name="author" content="Alex">
    <link rel="icon" href="/images/favicon.ico">
    <title>Bootstrap 4 Admin Panel</title>
    <link href="/webjars/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/dashboard.css" rel="stylesheet">
    <link href="/css/bootstrap-table.css" rel="stylesheet">
</head>

<body>

<nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Alex Soft</a>
    <ul class="navbar-nav px-3">
        <li class="nav-item text-nowrap">
            <a class="nav-link" href="/signout">Sign out</a>
        </li>
    </ul>
</nav>

<div class="container-fluid">
    <div class="row">
        <nav class="col-md-2 d-none d-md-block bg-light sidebar">
            <div class="sidebar-sticky">
                <ul class="nav flex-column">
                    <li class="nav-item">
                        <a class="nav-link active" href="/adminpanel">
                            <span data-feather="user"></span>
                            Admin
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/userpanel.html">
                            <span data-feather="users"></span>
                            User
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
            <h2>Users in DB</h2>
            <p class="toolbar">
                <a class="create btn btn-outline-primary" href="javascript:">Create User</a>
                <span class="alert"></span>
            </p>

            <div class="table-responsive">
                <table id="userstable"
                       class="table table-striped table-sm"
                       data-search="true">
                    <thead>
                    <tr>
                        <th data-field="id">User ID</th>
                        <th data-field="username">Username</th>
                        <th data-field="firstName">First Name</th>
                        <th data-field="lastName">Last Name</th>
                        <th data-field="email">email</th>
                        <th data-field="roles">Roles</th>
                    </tr>
                    </thead>
                </table>
            </div>
            <!-- Modal -->
            <div id="modal" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title"></h4>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>User ID</label>
                                <input type="number" class="form-control" name="id" placeholder="User ID" disabled>
                            </div>
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" class="form-control"
                                       name="username" placeholder="Username">
                            </div>
                            <div class="form-group">
                                <label>First Name</label>
                                <input type="text" class="form-control" name="firstName" placeholder="First Name">
                            </div>
                            <div class="form-group">
                                <label>Last Name</label>
                                <input type="text" class="form-control" name="lastName" placeholder="Last Name">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="text" class="form-control" name="email" placeholder="email">
                            </div>
                            <div class="form-group">
                                <label>Roles</label>
                                <input type="text" class="form-control"
                                       name="roles" id="roles"
                                       placeholder="Roles">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                            <button type="button" class="btn btn-danger remove">Delete</button>
                            <button type="button" class="btn btn-primary submit">Submit</button>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
            <!-- Modal -->
            <div id="modalcreate" class="modal fade">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title"></h4>
                            <button type="button" class="close"
                                    data-dismiss="modal"
                                    aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" class="form-control"
                                       name="username" placeholder="Username">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" class="form-control"
                                       name="password" placeholder="Password">
                            </div>
                            <div class="form-group">
                                <label>First Name</label>
                                <input type="text" class="form-control"
                                       name="firstName"
                                       placeholder="First Name">
                            </div>
                            <div class="form-group">
                                <label>Last Name</label>
                                <input type="text" class="form-control"
                                       name="lastName" placeholder="Last Name">
                            </div>
                            <div class="form-group">
                                <label>Email</label>
                                <input type="text" class="form-control"
                                       name="email" placeholder="email">
                            </div>
                            <div class="form-group">
                                <label>Roles</label>
                                <input type="text" class="form-control"
                                       name="roles" id="rolescreate"
                                       placeholder="Roles">
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default"
                                    data-dismiss="modal">Close
                            </button>
                            <button type="button"
                                    class="btn btn-primary submit">Submit
                            </button>
                        </div>
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div>
            <!-- /.modal -->
        </main>
    </div>
</div>

<script src="/webjars/jquery/3.3.1-1/jquery.min.js"></script>
<script src="/webjars/bootstrap/4.1.3/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
<script src="/js/ajaxscripts.js"></script>
<script src="/js/bootstrap-table.js"></script>

<script>
    var API_URL = 'http://' + location.host + '/users/',
        $table = $('#userstable').bootstrapTable({url: API_URL}),
        $modal = $('#modal').modal({show: false}),
        $modalcreate = $('#modalcreate').modal({show: false}),
        $alert = $('.alert').hide();

    $table.on('click-row.bs.table', function (e, row, $element) {
        showModal('Edit User', row);
    });

    $(function () {
        // create event
        $('.create').click(function () {
            $modalcreate.modal('show');
        });

        $modal.find('.submit').click(function () {
            var row = {};

            $modal.find('input[name]').each(function () {
                row[$(this).attr('name')] = $(this).val();

            });

            var roles = $('#roles').val().split(',').map(String);

            row['roles'] = roles;

            $.ajax({
                url: API_URL + ($modal.data('id') || ''),
                type: $modal.data('id') ? 'put' : 'post',
                contentType: 'application/json',
                data: JSON.stringify(row),
                success: function () {
                    $modal.modal('hide');
                    $table.bootstrapTable('refresh');
                    showAlert(($modal.data('id') ? 'Update' : 'Create') + ' user successful!', 'success');
                },
                error: function () {
                    $modal.modal('hide');
                    showAlert(($modal.data('id') ? 'Update' : 'Create') + ' user error!', 'danger');
                }
            });
        });

        $modalcreate.find('.submit').click(function () {
            var row = {};

            $modalcreate.find('input[name]').each(function () {
                row[$(this).attr('name')] = $(this).val();
            });

            row['roles'] = $('#modalcreate #rolescreate').val().split(',').map(String);

            $.ajax({
                url: API_URL,
                type: 'post',
                contentType: 'application/json',
                data: JSON.stringify(row),
                success: function () {
                    $modalcreate.modal('hide');
                    $table.bootstrapTable('refresh');
                    showAlert('User created successfully!', 'success');
                },
                error: function () {
                    $modalcreate.modal('hide');
                    showAlert('Error during user creation!', 'danger');
                }
            });
        });

        $modal.find('.remove').click(function () {
            if ($(this).hasClass('disabled')) {
                return false;
            } else {
                if (confirm('Are you sure to delete this user?')) {
                    $.ajax({
                        url: API_URL + $modal.data('id'),
                        type: 'delete',
                        success: function () {
                            $modal.modal('hide');
                            $table.bootstrapTable('refresh');
                            showAlert('Delete user successful!', 'success');
                        },
                        error: function () {
                            $modal.modal('hide');
                            showAlert('Delete user error!', 'danger');
                        }
                    })
                }
            }
        });
    });

    function showModal(title, row) {
        row = row || {
            id: '',
            username: '',
            firstName: '',
            lastName: '',
            email: '',
            roles: ''
        }; // default row value

        $modal.data('id', row.id);
        $modal.find('.modal-title').text(title);
        for (var name in row) {
            $modal.find('input[name="' + name + '"]').val(row[name]);
        }
        $('.remove').prop('disabled', false);
        $modal.modal('show');
    }

    function showAlert(title, type) {
        $alert.attr('class', 'alert alert-' + type || 'success')
            .html('<i class="glyphicon glyphicon-check"></i> ' + title).show();
        setTimeout(function () {
            $alert.hide();
        }, 3000);
    }

    feather.replace();
</script>
</body>
</html>